<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DocuMind ‚Äî –ê–Ω–∞–ª–∏–∑ –∏ –ö–æ–Ω—Å–ø–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</title>
    <style>
        /* ---------- –°—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–µ ---------- */
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color:#EFEDE3; color:#302F2C; min-height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:20px; }
        .container { width:100%; max-width:700px; background:white; border-radius:16px; box-shadow:0 4px 25px rgba(0,0,0,0.1); padding:35px; text-align:center; }
        h1 { margin-bottom:20px; font-weight:600; color:#302F2C; font-size:28px; }

        /* ---------- –í–∫–ª–∞–¥–∫–∏ ---------- */
        .tabs { display:flex; justify-content:center; gap:10px; margin-bottom:30px; }
        .tab {
            padding:10px 20px;
            border-radius:20px;
            border:2px solid #302F2C;
            cursor:pointer;
            transition:all 0.3s ease;
            background:rgba(239,237,227,0.2);
        }
        .tab.active { background-color:#302F2C; color:white; }

        /* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å */
        .upload-area { border:2px dashed #302F2C; border-radius:12px; padding:45px 25px; cursor:pointer; transition:all 0.3s ease; margin-bottom:30px; position:relative; background:rgba(239,237,227,0.2); }
        .upload-area:hover { background-color:rgba(239,237,227,0.4); transform:translateY(-2px); }
        .upload-area input[type="file"] { position:absolute; width:100%; height:100%; top:0; left:0; opacity:0; cursor:pointer; }
        .loading-container { display:none; flex-direction:column; align-items:center; justify-content:center; margin:35px 0; }
        .spinner { width:55px; height:55px; border:5px solid rgba(48,47,44,0.2); border-radius:50%; border-top-color:#302F2C; animation:spin 1s ease-in-out infinite; margin-bottom:22px; }
        @keyframes spin { to { transform:rotate(360deg);} }
        .file-info { display:none; background-color:rgba(239,237,227,0.3); padding:18px; border-radius:12px; margin-top:25px; text-align:left; position:relative; border:1px solid #E5E3DC; }
        .remove-file { position:absolute; right:18px; top:18px; background:none; border:none; color:#ff4d4d; cursor:pointer; font-size:20px; width:30px; height:30px; border-radius:50%; display:flex; align-items:center; justify-content:center; transition:background-color 0.2s; }
        .remove-file:hover { background-color:rgba(255,77,77,0.1); }
        .search-section { display:none; width:100%; margin-top:25px; background:rgba(239,237,227,0.3); padding:25px; border-radius:12px; border:1px solid #E5E3DC; }
        .search-input-container { position:relative; width:100%; margin-bottom:20px; }
        .search-input { width:100%; padding:16px 95px 16px 20px; border:2px solid #302F2C; border-radius:25px; font-size:16px; background-color:white; outline:none; transition:border-color 0.3s; }
        .search-button { position:absolute; right:6px; top:50%; transform:translateY(-50%); background-color:#302F2C; color:white; border:none; padding:10px 20px; border-radius:20px; cursor:pointer; font-size:14px; font-weight:500; transition:background-color 0.3s; height:38px; display:flex; align-items:center; justify-content:center; }
        .results-container { display:none; margin-top:25px; text-align:left; background-color:rgba(239,237,227,0.3); padding:25px; border-radius:12px; border:1px solid #E5E3DC; }
        .result-item { padding:15px; background:white; border-radius:8px; margin-bottom:12px; box-shadow:0 2px 8px rgba(0,0,0,0.05); }
        .message { margin-top:15px; font-weight:500; text-align:center; }
        .success { color:#2ecc71; } .error { color:#e74c3c; }
    </style>
</head>
<body>
<div class="container">
    <h1>DocuMind</h1>

    <div class="tabs">
        <div class="tab active" id="normalTab">–û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º</div>
        <div class="tab" id="abstractTab">–ö–æ–Ω—Å–ø–µ–∫—Ç–Ω—ã–π —Ä–µ–∂–∏–º</div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç (–æ–±—â–∏–π) -->
    <div class="upload-area" id="uploadArea">
        <i>üìÑ</i>
        <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ PDF-—Ñ–∞–π–ª —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</p>
        <p class="small">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç: PDF</p>
        <input type="file" id="fileInput" accept=".pdf">
    </div>

    <div class="loading-container" id="loadingContainer">
        <div class="spinner"></div>
        <p id="loadingText">–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–∞...</p>
    </div>

    <div class="file-info" id="fileInfo">
        <span class="file-name" id="fileName"></span>
        <button class="remove-file" id="removeFile">√ó</button>
    </div>

    <div id="message" class="message"></div>

    <div class="search-section" id="searchSection">
        <div class="search-input-container">
            <input type="text" class="search-input" id="searchInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å...">
            <button class="search-button" id="searchButton">–ù–∞–π—Ç–∏</button>
        </div>
    </div>

    <div class="results-container" id="resultsContainer">
        <div class="results-header">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</div>
        <div id="searchResults"></div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const tabs = { normal: document.getElementById('normalTab'), abstract: document.getElementById('abstractTab') };
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const loadingContainer = document.getElementById('loadingContainer');
        const loadingText = document.getElementById('loadingText');
        const fileInfo = document.getElementById('fileInfo');
        const fileName = document.getElementById('fileName');
        const removeFile = document.getElementById('removeFile');
        const searchSection = document.getElementById('searchSection');
        const searchInput = document.getElementById('searchInput');
        const searchButton = document.getElementById('searchButton');
        const resultsContainer = document.getElementById('resultsContainer');
        const searchResults = document.getElementById('searchResults');
        const message = document.getElementById('message');
        const baseUrl = 'http://localhost:8080';

        let mode = 'normal'; // normal | abstract
        let currentFile = null;
        let docId = null;

        // --- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫ ---
        tabs.normal.addEventListener('click', () => switchMode('normal'));
        tabs.abstract.addEventListener('click', () => switchMode('abstract'));

        function switchMode(m) {
            mode = m;
            for (const key in tabs) tabs[key].classList.remove('active');
            tabs[m].classList.add('active');
            resetUI();
            message.textContent = (m === 'normal')
                ? '–û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º ‚Äî –∑–∞–¥–∞–≤–∞–π—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç—É.'
                : '–ö–æ–Ω—Å–ø–µ–∫—Ç–Ω—ã–π —Ä–µ–∂–∏–º ‚Äî —Å–æ–∑–¥–∞—ë—Ç —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–µ –æ–±–æ–±—â–µ–Ω–∏—è –∏ –∫–æ–Ω—Å–ø–µ–∫—Ç—ã.';
        }

        function generateUUID() {
            return ([1e7]+-1e3+-4e3+-8e3+-1e11)
                .replace(/[018]/g, c =>
                    (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
                );
        }

        fileInput.addEventListener('change', e => e.target.files.length && handleFileUpload(e.target.files[0]));
        removeFile.addEventListener('click', resetUI);
        searchButton.addEventListener('click', performSearch);
        searchInput.addEventListener('keypress', e => e.key === 'Enter' && performSearch());

        function handleFileUpload(file) {
            if (file.type !== 'application/pdf') return alert('–í—ã–±–µ—Ä–∏—Ç–µ PDF-—Ñ–∞–π–ª');
            currentFile = file;
            docId = generateUUID();

            fileName.textContent = file.name;
            uploadArea.style.display = 'none';
            loadingContainer.style.display = 'flex';
            loadingText.textContent = '–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–∞...';

            const formData = new FormData();
            formData.append('file', file);
            formData.append('docId', docId);

            const endpoint = mode === 'normal' ? '/load-pdf' : '/abstract-load';

            fetch(`${baseUrl}${endpoint}`, { method: 'POST', body: formData, mode: 'cors' })
                .then(r => r.text())
                .then(() => {
                    loadingContainer.style.display = 'none';
                    fileInfo.style.display = 'block';
                    searchSection.style.display = 'block';
                    message.textContent = '–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω! –ú–æ–∂–Ω–æ –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã.';
                    message.className = 'message success';
                })
                .catch(() => {
                    loadingContainer.style.display = 'none';
                    uploadArea.style.display = 'block';
                    message.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞.';
                    message.className = 'message error';
                });
        }

        function performSearch() {
            const query = searchInput.value.trim();
            if (!query) return alert('–í–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å');

            loadingContainer.style.display = 'flex';
            loadingText.textContent = '–§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç...';

            const endpoint = mode === 'normal' ? '/search' : '/abstract-search';

            fetch(`${baseUrl}${endpoint}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json; charset=UTF-8' },
                body: JSON.stringify({ question: query, docId }),
                mode: 'cors'
            })
            .then(r => r.text())
            .then(data => {
                loadingContainer.style.display = 'none';
                displayResult(data);
            })
            .catch(() => {
                loadingContainer.style.display = 'none';
                message.textContent = '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ.';
                message.className = 'message error';
            });
        }

        function displayResult(result) {
            resultsContainer.style.display = 'block';
            searchResults.innerHTML = `<div class="result-item"><p>${result || '–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ'}</p></div>`;
            message.textContent = '–ü–æ–∏—Å–∫ –∑–∞–≤–µ—Ä—à—ë–Ω!';
            message.className = 'message success';
        }

        function resetUI() {
            fileInfo.style.display = 'none';
            searchSection.style.display = 'none';
            resultsContainer.style.display = 'none';
            uploadArea.style.display = 'block';
            message.textContent = '';
            searchInput.value = '';
            searchResults.innerHTML = '';
        }
    });
</script>
</body>
</html>
